# Web 实时推送技术

## Web 实时推送技术的应用

工业运行监控、Web 在线通讯、即时报价系统、在线游戏等。

这些都场景都需要将后台的变化主动地、实时地传送到浏览器，而不需要用户手动刷新页面。

## 双向通信

1. 轮询

优点：简单、易实现。
缺点：时间间隔不好控制，间隔长，用户获取不到最新信息，间隔短，服务器压力大。

2. 长轮询

长轮询是轮询的改进版，客户端发送 HTTP 请求给服务器后，如果没有新消息就一直等待，当有新消息的时候，才会返回给客户端，
在某种程度上减小了网络宽带和 CPU 利用率等问题。由于 http 数据包的头部数据量往往很大（通常有400多个字节），
其中服务器真正需要的却很少（有时只有10个字节左右），这样的数据包在网络上周期性的传输，是对网络宽带的一种浪费。

优点：有较好的时效性。
缺点：保持连接会消耗资源；服务器没有返回有效数据，程序超时。

3. iframe

在页面中插入一个隐藏的 iframe，利用其 src 属性在服务器和客户端之间创建一条长连接，服务器向 iframe 传输数据（通常是 HTML，内有负责插入信息的 JavaScript），来实时更新页面。

优点：消息能及时送达；浏览器兼容性好。
缺点：服务器维持一个长连接增加开销；有些浏览器会显示加载没有完成，图标不停旋转。

4. WebSocket协议

### 什么是 WebSocket 协议

它是把 TCP 的 Scoket（套接字）应用在 Webpage 上，使通信双方建立起一个保持在活动状态的连接通道。

服务器和客户端之间一旦建立起 WebSocket 协议的通信连接，之后的通信都依靠这个专有的协议进行，双方可以互发报文。
通信中可以发送 JSON, HTML, XML, 图片等任意格式的数据。它是建立在 HTTP 基础上的协议，仍然由客户端发起连接。

### HTTP 协议的局限性

- HTTP 是半双工协议。在同一时刻，数据是单向流动的，客户端发起请求或服务器响应请求
- 服务器不能主动推送数据给客户端。

### WebSocket 的特点

- 支持双向通信，实时性更强
- 可以发送文本，可以发送二进制数据
- 减少通信量：只要建立起 WebSocket 连接，就希望一直保持连接状态。和 HTTP 相比，不但每次连接时的总开销减少，
  而且由于 WebSocket 的首部信息很小，通信量也响应的减少了
- 实时性。无需发起多次请求，极大的节省了网络宽带资源的消耗。

## [浅谈Web 实时推送技术，有对比，有总结](https://cloud.tencent.com/developer/news/399403)